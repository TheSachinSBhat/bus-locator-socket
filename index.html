<html>
  <body>
    <p id='server-time'></p>
    <div>
        <label>User Location</label>
        <div id="user-location-div">
            <div id="startLat"></div>
            <div id="startLon"></div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA5w4IA_fIDe8Iex8ybjYf8N7a2hMNkGA"></script>
    <script>
      var socket = io();
      var el = document.getElementById('server-time');

      socket.on('time', function(timeString) {
        el.innerHTML = 'Server time: ' + timeString;
      });

      // Get User location on page load
      getUserLocation();

      /* Method that returns location co-ordinates of the user */
      function getUserLocation() {
          options = {
              enableHighAccuracy: true,
              timeout: 5000,
              maximumAge: 0
          };


          // Reference: https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/watchPosition
          id = navigator.geolocation.watchPosition(sendBusLocation, error, options);
      }

      function error(err) {
          console.warn('ERROR(' + err.code + '): ' + err.message);
      }


      /* Method that sends the bus current location to server */
      function sendBusLocation(pos) {
          var busLocation = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
          socket.emit('buslocation', busLocation);
      }

      socket.on('buslocation', function (busLocationData) {
          updateUserLocation(busLocationData);
      });

      /* Method that updates the user's current location */
      function updateUserLocation(pos) {
          document.getElementById('startLat').innerHTML = pos.lat;
          document.getElementById('startLon').innerHTML = pos.lng;

          //// TODO: Update user location on map
          //busLocation = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
          //busMarker.setPosition(busLocation);

          //var currCenter = map.getCenter();
          //google.maps.event.trigger(map, 'resize');
          //// Re-center map to the current bus location
          //map.setCenter(busLocation);

          //// Get the path of the bus from the polyline
          //var busPath = busRoutePolyline.getPath();

          //// Because path is an MVCArray, we can simply append a new coordinate
          //// and it will automatically appear.
          //// Append the current bus location to the bus path
          //busPath.push(busLocation);

      }
    </script>
  </body>
</html>
